---
title: "Import OLIS spectral data"
author: "Douglas A. Campbell, Sylwia Sliwinska-Wilczewska, Sarah Gore, Adrian Kryk, Mireille Savoie"
date: "`r format(Sys.Date())`"
output:
  html_document:
    df_print: paged
    code_folding: show
---

# Import spectral files generated by OLIS spectrophotometer
# Import emission files generated by Jaz spectrophotometer
# Calculate PUR of each Strain at each spectral color and PAR

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
knitr::opts_chunk$set(fig.path='Figs/')
```

```{r set project variables, include = FALSE}

Project <- "PICO"


DataIn <- file.path("..", "Data","RawData", "OLISSpectraCorr", fsep = .Platform$file.sep)

DataInCatalog <- file.path("..", "Data", fsep = .Platform$file.sep)

DataInSpectra <- file.path("..", "Data", "ProcessedData",  fsep = .Platform$file.sep)

DataInPAR <- file.path("..", "Data","RawData","MCEmissionSpectra", fsep = .Platform$file.sep)

DataOut <- file.path("..", "Data", "ProcessedData","MultiCultiEmissionData")

FileID <- "Smooth"

#MDPicoGoogle <- "https://docs.google.com/spreadsheets/d/1Lerp5u25kzBtaBbnOYElYqUP59cn68gJpxxayhnGdkw/edit#gid=0"

FileEncode <- "UTF-8" 
Delimiter <- ""

HeaderRows <- 0
RollWindow <- 10

```


```{r load libraries} 
# libraries; Note check actual dependencies
library(tidyverse)
library(lubridate)
library(stringr)
library(broom)
# library(knitr)
# library(OneR)
library(zoo)
# library(strucchange)
# library(plotly)
# library(dplyr)
# library(magrittr)
# library(googledrive)
# library(googlesheets4)
library(readxl)

library(ggspectra)
library(ggpubr)
library(caret)
```

```{r set colours}
Wavelengths_nm = c(405, 450, 475, 530, 615, 660, 730, "WW")
Colours_nm = c("violet", "darkblue", "dodgerblue", "darkgreen","orange","red","purple", "black")

names(Colours_nm) <- Wavelengths_nm
Colours_nm


# StrainNames = c("MIT9313" , "SS120", "MED4")
# ColoursStrain <- c("#E69F00","#F0E442","#CC79A7")

ColoursStrain = c(MIT9313 = "#E69F00", SS120 = "#F0E442", MED4 = "#CC79A7" )
# names(ColoursStrain) <- StrainNames
# ColoursStrain

```

For SySl files 'baseline' in filename means baseline spectra already subtracted within OLIS software.
This was not universallly true across all projects; be careful.
For SySl files 'raw' means spectra of undiluted culture; other spectra are 1 or 4 ml culture + 8 or 4 ml media.

Ideally: we want to read and tidy some user-selected set of files taken from multiple dates

```{r list available OLIS ascii Files}
OlisAsciiFiles <- list.files(path = DataIn, pattern = ".asc", full.names = TRUE)
OlisAsciiFiles

#test for duplicate file names
unique(duplicated(OlisAsciiFiles))
```


# set up read_delim_plus
```{r}
# #make this more robust to variable file formats
#FileEncode <- "UTF-8"
#Delimiter <- ""
# #.asc files from export from OLIS seem to use spaces as delimiter
# 
#HeaderRows <- 0

read.delim_plus <- function(flnm, filencode, delimiter, headerrows){read.delim(flnm, fileEncoding = filencode, sep = delimiter,  skip = headerrows, header = FALSE, row.names = NULL) %>%
     mutate(Filename = flnm, Cdatetime = ymd_hms(file.info(flnm)$ctime))
}

#read.delim_long meant for map over a vector of filepaths to read, convert to long format and tidy the imported data
read.delim_long <- function(flnm, filencode, delimiter, headerrows){read.delim(flnm, fileEncoding = filencode, sep = delimiter,  skip = headerrows, header = TRUE, row.names = NULL) %>%
    mutate(Filename = flnm, Cdatetime = ymd_hms(file.info(flnm)$ctime)) %>%
 rename(nm = X350) %>%
  mutate(FirstLastSpec = str_extract(Filename, "_[A-Z][a-z][A-Z][a-z][:digit:][:digit:][:digit:][:digit:]_[A-Z][a-z][A-Z][a-z][:digit:][:digit:][:digit:][:digit:]_")) %>%
  mutate(SampleNumbers = str_extract_all(FirstLastSpec, "[:digit:][:digit:][:digit:][:digit:]")) %>%
  mutate(FirstSampleNumber = as.numeric(map(SampleNumbers, ~.[[1]]))) %>%
  mutate(LastSampleNumber = as.numeric(map(SampleNumbers, ~.[[2]]))) %>%
  mutate(OperatorID = str_extract(Filename,"[A-Z][a-z][A-Z][a-z]")) %>%
  pivot_longer(cols = starts_with("X"), names_to = "SpectraID", values_to = "Abs") %>%
  mutate(SampleCode = as.numeric(str_remove(SpectraID, "X"))) %>%
  mutate(SampleNumber = SampleCode - min(SampleCode, na.rm = TRUE) + FirstSampleNumber) %>%
  relocate(OperatorID, SampleNumber) %>%
  unite(col = SampleID, OperatorID:SampleNumber, sep = "", remove = FALSE) %>%
  arrange(SampleID, nm) %>%
  relocate(SampleID, nm, Abs) %>%
  mutate(SpectraDate = str_extract(Filename, "/[:digit:][:digit:][:digit:][:digit:][:digit:][:digit:][:digit:][:digit:]_"),
         SpectraDate = str_remove_all(SpectraDate, "_"),
         SpectraDate = str_remove_all(SpectraDate, "/"),
         SpectraDate = ymd(SpectraDate)
  )
}
```


# Import OLISSpectra files
```{r import OLIS jav corr file}

TargetFile <-  OlisAsciiFiles

TargetSpectra <- TargetFile %>% map_df(~read.delim_plus(flnm = ., filencode = FileEncode, delimiter = Delimiter, headerrows = FALSE)) %>% 
  #pivot_longer(., -c(`X375`, Filename, Cdatetime), values_to = "Absorbance", names_to = "SampleID") %>%
   rename(nm = `V1`,
          Absorbance = `V2`) %>% 
  filter(!is.na(Absorbance))
    
  #separate(col = SampleID, into = c("SampleID", "Replicate"), sep = "_")

TargetSpectra <- TargetSpectra %>%
  # rename(nm = OLIS.3D.ASCII) %>%
  separate(col = Filename, into = c("fp1", "fp2", "fp3", "fp4","SpectraDate", "Project", "CultureID", "Range", "Type", "Correction", "Smooth"), sep = "([\\/\\_\\:])", remove = FALSE) 


TargetSpectra <- TargetSpectra %>%
  select(-c(fp1, fp2, fp3, fp4, Type, Correction, Smooth)) %>% 
  mutate(SpectraDate = str_extract(Filename, "/202[:digit:][:digit:][:digit:][:digit:][:digit:]"),
           SpectraDate = ymd(str_extract(SpectraDate, "202[:digit:][:digit:][:digit:][:digit:][:digit:]")))

glimpse(TargetSpectra)
```

Load Multiculti catalog
```{r load local multiculticatalog, message = FALSE, warning = FALSE, echo=FALSE}


# MultiCulti metadata filtered to include only runs for Prochlorococcus O2 Project
CultureCatalog <- readRDS(file = file.path(DataInCatalog, "CultureCatalog.Rds")) %>%
 
  # ggplot/dplyr doesn't like working with a dataframe of lists.
  # In this case WL is set to a list since some values are numbers, some are strings, some are blank.
  # To fix this, first drop all rows missing WL, then unlist.
  # Must first drop NA rows since unlist will collapse NULL lists, then the unlisted WL is a shorter length than original WL column, which mutate doesn't like.
  drop_na(WL) %>%
  mutate(WL = unlist(WL))



CultureCatalog <- CultureCatalog %>%
   mutate(ExpDate = ymd(ExpDate),
          ExpEndDate = ymd_hms(`ExpEndDate`)) 


```


# Merge OLISSpectra with MetaData
```{r OLISDateSpectra with MetaData}


OLISSpectraMeta <- CultureCatalog %>%
  right_join(., TargetSpectra, by = c("ID" = "CultureID"))


OLISSpectraMeta <- OLISSpectraMeta %>%
group_by(ID) %>%
  arrange(SpectraDate) %>%
  mutate(E_days = as.numeric((SpectraDate - ExpDate[1]))) %>%
ungroup() 

remove(TargetSpectra)
remove(CultureCatalog)

glimpse(OLISSpectraMeta)

```


List the rds of spectras that were combined in 1 ascii file but separated in 'OlisImportCombined_MS.Rmd'
```{r read list available OLIS rds Files}
OlisRdsFiles <- list.files(path = DataIn, pattern = ".Rds", full.names = TRUE)
OlisRdsFiles

#test for duplicate file names
unique(duplicated(OlisRdsFiles))
```

# Read .Rds, Summarize, Combine to single data frame

## Create function using to read in .Rds, adding source filename as a column

```{r readRDS_plus}
readRDS_plus <- function(Flnm){readRDS(file = Flnm) 
  #%>%
    #mutate(Filename = Flnm)
}
```

## Read in ProcessedFiles .Rds
```{r read selected ProcessedData}
                                    
RdsData <-  OlisRdsFiles %>%
    map_df(~readRDS_plus(Flnm = .)) 

glimpse(RdsData)

```

merge all Olis spectra data from single ascii imported files and spectras from combined ascii files tidied in .rds files.
```{r}

OlisSpectraMetaCombined <- rbind(OLISSpectraMeta, RdsData) 

glimpse(OlisSpectraMetaCombined)

remove(OLISSpectraMeta)
remove(RdsData)
```

read emission spectras from MultiCultis for PUR determinations
```{r}

MC_Spectra <- readRDS(file = file.path(DataInSpectra, "PICO_MultiCultiSpectra.Rds"))

```

read measured PAR from Mulitcultis for PUR determinations
```{r}
MC_PAR <- read_csv(file = file.path(DataInPAR, "MultiCulti_PAR.csv"))

```

Unnest MC spectra and join MC measured PAR
```{r join MC emission and PAR data}


 MC_Spectra <- MC_Spectra %>%
  unnest(Spectra) %>%
  group_by(MultiCulti, Par, WL, Wavelength) %>%
  mutate(nm = round(Wavelength)) %>%
  ungroup() %>%
  group_by(Filename, MultiCulti, Par, WL, nm, is_nm) %>%
  summarise(MeanEmission = mean(Counts)) %>%
  ungroup() %>%
  mutate(Emission = round(MeanEmission, digits = 1),
         MC = MultiCulti,
         SetPar_uE = Par,
         ID = paste(MC,WL, sep = "_"))

MC_SpectraPAR <- left_join(MC_Spectra, MC_PAR, by = c("WL" = "Actinic_nm", "SetPar_uE", "MC" = "Multiculti")) %>%
  rename(EMSetPar_uE = 'SetPar_uE',
         EMMeasuredPar_uE = 'MeasuredPar_uE') %>% 
  select(-c(Par, MultiCulti))

MC_SpectraPAR <- MC_SpectraPAR %>% 
  filter(ID != "MCMIX004_WW",
         EMSetPar_uE == 30 ) %>% 
  rename(MC_SpectralID = 'ID') %>% 
  select(-c( Filename, MC)) %>% 
  group_by(WL) %>% 
  mutate(MC_NormEm = round(Emission / Emission[which.max(Emission)], digits = 4),
         MC_Max_nm = round(nm[which.max(Emission)])) %>% 
  select(-c(is_nm, MeanEmission, Date)) %>% 
ungroup()

OlisSpectraMetaData <- left_join(OlisSpectraMetaCombined , MC_SpectraPAR, by = c("WL", "nm"))
  

#   
#   pivot_wider(names_from = c("MultiCulti","WL"), values_from = "Counts") %>%
#   pivot_longer(c("MC257_WW", "MCMIX004_470", "MCMIX004_660", "MCMIX004_405","MCMIX004_450", "MCMIX004_530", "MCMIX004_620", "MCMIX004_730", "MCMIX004_WW"), names_to = "ID", values_to = "Emission" ) %>% 
#   group_by(ID) %>%
#   mutate(nm = round(Wavelength)) %>% 
#   ungroup()
# 
# MC_Spectra_test2 <- MC_Spectra_test %>% 
#   group_by(ID, nm)  %>% 
#   summarise(MeanAbs = (Emission)) %>% 
#   ungroup()
  
#OlisSpectraMetaData <- bind_rows(OlisSpectraMetaCombined, MC_Spectra)

remove(MC_PAR)
remove(MC_Spectra)
remove(MC_SpectraPAR)

```


Normalization
https://www.digitalocean.com/community/tutorials/normalize-data-in-r
```{r}
# OLISSpectraMetaNorm <- OlisSpectraMetaData %>%
# summary(Absorbance) 
# process <- preProcess(as.data.frame(Absorbance), method=c("range")) %>% 
# norm_scale <- predict(process, as.data.frame(Absorbance))
  
```


Find nm at red and blue max Chla peak then extract absorbance. Use this absorbance to normalize later on
```{r}
OlisSpectraMetaData_red <- OlisSpectraMetaData %>% 
  filter(Run != 35) %>% 
  group_by(ID, E_days) %>%
  filter(nm >= 575 & nm <= 750) %>% 
   mutate(Red_nm = round(nm[which.max(Absorbance)]),
          MaxAbs_Red_nm = Absorbance[which.max(Absorbance)]) %>% 
  ungroup() %>% 
  filter(nm == 675) %>% 
  select(ID, Strain, Red_nm, MaxAbs_Red_nm, Par_ue, E_days)

 OlisSpectraMetaData <- left_join(OlisSpectraMetaData, OlisSpectraMetaData_red)
 
 OlisSpectraMetaData_blue <- OlisSpectraMetaData %>% 
  group_by(ID, E_days) %>%
  filter(nm >= 400 & nm <= 460) %>% 
   mutate(Blue_nm = round(nm[which.max(Absorbance)]),
          MaxAbs_Blue_nm = Absorbance[which.max(Absorbance)]) %>% 
  ungroup() %>% 
  filter(nm == 440) %>% 
  select(ID, Strain, Blue_nm,MaxAbs_Blue_nm,  Par_ue, E_days)

 OlisSpectraMetaData <- left_join(OlisSpectraMetaData, OlisSpectraMetaData_blue)
 
 remove(OlisSpectraMetaData_red)
 remove(OlisSpectraMetaData_blue)
 remove(OlisSpectraMetaCombined)

 glimpse(OlisSpectraMetaData)
 
```

Normalization
Used max peak of each spectra to normalize peaks to red Chla region (750 < nm > 575) and blue Chla region (460 < nm > 400 )
```{r}

OlisSpectraMetaData <- OlisSpectraMetaData %>% 
  group_by(ID, E_days) %>%
 mutate(NormAbs_Blue_nm = Absorbance / MaxAbs_Blue_nm,
        NormAbs_Red_nm = Absorbance / MaxAbs_Red_nm) %>% 
  ungroup()

glimpse(OlisSpectraMetaData)
```

PUR Calculations

```{r PUR}
OlisSpectraMetaData <- OlisSpectraMetaData %>%
    filter(nm >= 400 &
           nm <= 700) %>%
  mutate(PURAbsWholeCell_Norm = MC_NormEm * NormAbs_Blue_nm) %>% 
  group_by(ID, E_days) %>% 
  mutate(SumPURAbsWholeCell_Norm = sum(MC_NormEm * NormAbs_Blue_nm),
         CalcPur_ue = round(Par_ue * (SumPURAbsWholeCell_Norm / sum(MC_NormEm))),
         ParPurRatio = sum(MC_NormEm) / SumPURAbsWholeCell_Norm,
         PurParRatio =  SumPURAbsWholeCell_Norm / sum(MC_NormEm)) %>% 
ungroup() %>% 
  select(-SumPURAbsWholeCell_Norm)

glimpse(OlisSpectraMetaData)

```

Find Strain specific average PUR for each spectral color and each growth PAR 
```{r Calc mean PUR}

OlisSpectraMetaData <- OlisSpectraMetaData %>%
  group_by(Strain, WL) %>% 
  mutate(meanParPurRatio = (mean(ParPurRatio)),
         meanPurParRatio = (mean(PurParRatio)))%>% 
ungroup() 

OlisSpectraMetaData <- OlisSpectraMetaData %>%
  group_by(Strain, WL, Par_ue) %>% 
  mutate(Pur_ue = round(mean(CalcPur_ue)))%>% 
ungroup() 

```


Nest 
```{r Nest}

PicoNestedPurOlisData <- OlisSpectraMetaData %>% 
  group_by(ID, E_days) %>% 
  nest(PurData = c(nm, Absorbance, Emission, MC_NormEm, PURAbsWholeCell_Norm, NormAbs_Red_nm, NormAbs_Blue_nm,  EMMeasuredPar_uE, EMSetPar_uE, MC_SpectralID, SpectraDate, Range, Cdatetime))


```

# save nested 
```{r Save rds}

# saveRDS(object = PicoNestedPurOlisData, file = file.path(DataOut, "PicoNestedPurOlisData.Rds"))

saveRDS(PicoNestedPurOlisData, file.path(DataOut, paste(Project, "PicoNestedPurOlisData.Rds", sep = "_"), fsep = .Platform$file.sep))

```
 

```{r, Initial Plots}
OlisSpectraMetaData %>%
  ggplot() +
  geom_point(aes(x = nm, y = Absorbance, colour = as.factor(WL), label = ID)) +
  scale_color_manual(values = Colours_nm) +
 # guides(colour = FALSE) +
  labs(y = "Absorbance", x = "Wavelength (nm)") +
  scale_y_continuous(breaks=seq(0, 0.2, by = 0.05)) +
  coord_cartesian(ylim = c (0, 0.2)) +
  ggh4x::facet_nested(rows = vars(Par_ue),cols = vars(Strain, WL), labeller = labeller(Strain = label_value, WL = label_both, Photoperiod = label_both, Par_ue = label_both)) +
  theme_bw()+
  labs(colour = "Actinic PAR (nm)")



OlisSpectraMetaData %>%
   filter(Strain == "MED4",
          ID != "MiSa1289",
          ID != "MiSa1294") %>% 
  ggplot() +
  geom_point(aes(x = nm, y = NormAbs_Blue_nm, colour = "violet", label = ID)) +
  geom_point(aes(x = nm, y = Absorbance, colour = as.factor(WL), label = ID)) +
  scale_color_manual(values = Colours_nm) +
 # guides(colour = FALSE) +
  labs(subtitle = "Normalized to Max Abs in blue range (400 to 460 nm)", y = "Normalized Absorbance", x = "Wavelength (nm)") +
  #scale_y_continuous(breaks=seq(0, 0.2, by = 0.05)) +
 # coord_cartesian(ylim = c (0, 0.2)) +
  ggh4x::facet_nested(rows = vars(Par_ue),cols = vars(Strain, WL), labeller = labeller(Ex_WL = label_both, strain = label_value, WL = label_both, Photoperiod = label_both, Par_ue = label_both)) +
  theme_bw()+
  labs(colour = "Actinic PAR (nm)")



OlisSpectraMetaData %>%
   filter(Strain == "MED4",
          ID != "MiSa1289",
          ID != "MiSa1294") %>% 
  ggplot() +
  geom_point(aes(x = nm, y = NormAbs_Red_nm, colour = "violet", label = ID)) +
  geom_point(aes(x = nm, y = Absorbance, colour = as.factor(WL), label = ID)) +
  scale_color_manual(values = Colours_nm) +
  #guides(colour = FALSE) +
 labs(subtitle = "Normalized to Max Abs in red range (575 to 750 nm)", y = "Normalized Absorbance", x = "Wavelength (nm)") +
  # scale_y_continuous(breaks=seq(0, 0.2, by = 0.05)) +
  # coord_cartesian(ylim = c (0, 0.2)) +
 ggh4x::facet_nested(rows = vars(Par_ue),cols = vars(Strain, WL), labeller = labeller(Ex_WL = label_both, strain = label_value, WL = label_both, Photoperiod = label_both, Par_ue = label_both)) +
  theme_bw()+
  labs(colour = "Actinic PAR (nm)")

OlisSpectraMetaData %>%
   filter(Strain == "SS120",
          ID != "MiSa1289",
          ID != "MiSa1315") %>% 
  ggplot() +
  geom_point(aes(x = nm, y = NormAbs_Blue_nm, colour = "violet", label = ID)) +
  geom_point(aes(x = nm, y = Absorbance, colour = as.factor(WL), label = ID)) +
  scale_color_manual(values = Colours_nm) +
 # guides(colour = FALSE) +
  labs(subtitle = "Normalized to Max Abs in blue range (400 to 460 nm)", y = "Normalized Absorbance", x = "Wavelength (nm)") +
  #scale_y_continuous(breaks=seq(0, 0.2, by = 0.05)) +
 # coord_cartesian(ylim = c (0, 0.2)) +
  ggh4x::facet_nested(rows = vars(Par_ue),cols = vars(Strain, WL), labeller = labeller(Ex_WL = label_both, strain = label_value, WL = label_both, Photoperiod = label_both, Par_ue = label_both)) +
  theme_bw()+
  labs(colour = "Actinic PAR (nm)")



OlisSpectraMetaData %>%
   filter(Strain == "SS120",
          ID != "MiSa1289",
          ID != "MiSa1315") %>% 
  ggplot() +
  geom_point(aes(x = nm, y = NormAbs_Red_nm, colour = "violet", label = ID)) +
  geom_point(aes(x = nm, y = Absorbance, colour = as.factor(WL), label = ID)) +
  scale_color_manual(values = Colours_nm) +
  #guides(colour = FALSE) +
 labs(subtitle = "Normalized to Max Abs in red range (575 to 750 nm)", y = "Normalized Absorbance", x = "Wavelength (nm)") +
  # scale_y_continuous(breaks=seq(0, 0.2, by = 0.05)) +
  # coord_cartesian(ylim = c (0, 0.2)) +
 ggh4x::facet_nested(rows = vars(Par_ue),cols = vars(Strain, WL), labeller = labeller(Ex_WL = label_both, strain = label_value, WL = label_both, Photoperiod = label_both, Par_ue = label_both)) +
  theme_bw()+
  labs(colour = "Actinic PAR (nm)")

OlisSpectraMetaData %>%
   filter(Strain == "MIT9313",
          ID != "MiSa1294",
          ID != "MiSa1315") %>% 
  ggplot() +
  geom_point(aes(x = nm, y = NormAbs_Blue_nm, colour = "violet", label = ID)) +
  geom_point(aes(x = nm, y = Absorbance, colour = as.factor(WL), label = ID)) +
  scale_color_manual(values = Colours_nm) +
 # guides(colour = FALSE) +
  labs(subtitle = "Normalized to Max Abs in blue range (400 to 460 nm)", y = "Normalized Absorbance", x = "Wavelength (nm)") +
  #scale_y_continuous(breaks=seq(0, 0.2, by = 0.05)) +
 # coord_cartesian(ylim = c (0, 0.2)) +
  ggh4x::facet_nested(rows = vars(Par_ue),cols = vars(Strain, WL), labeller = labeller(Ex_WL = label_both, strain = label_value, WL = label_both, Photoperiod = label_both, Par_ue = label_both)) +
  theme_bw()+
  labs(colour = "Actinic PAR (nm)")



OlisSpectraMetaData %>%
   filter(Strain == "MIT9313",
          ID != "MiSa1315",
          ID != "MiSa1294") %>% 
  ggplot() +
  geom_point(aes(x = nm, y = NormAbs_Red_nm, colour = "violet", label = ID)) +
  geom_point(aes(x = nm, y = Absorbance, colour = as.factor(WL), label = ID)) +
  scale_color_manual(values = Colours_nm) +
  #guides(colour = FALSE) +
 labs(subtitle = "Normalized to Max Abs in red range (575 to 750 nm)", y = "Normalized Absorbance", x = "Wavelength (nm)") +
  # scale_y_continuous(breaks=seq(0, 0.2, by = 0.05)) +
  # coord_cartesian(ylim = c (0, 0.2)) +
 ggh4x::facet_nested(rows = vars(Par_ue),cols = vars(Strain, WL), labeller = labeller(Ex_WL = label_both, strain = label_value, WL = label_both, Photoperiod = label_both, Par_ue = label_both)) +
  theme_bw()+
  labs(colour = "Actinic PAR (nm)")


```

# Stock cultures grown in incubators 
```{r stock cultures}

# Stock_ID = c("MiSa1289", "MiSa1294", "MiSa1315")
# Culture_ID = c("MIT9313", "SS120", "MED4")
# 
# names(ColoursMiSaID) <- Stock_ID

Stock_ID = c(MiSa1289 = "#E69F00", MiSa1294 = "#F0E442", MiSa1315 = "#CC79A7")
Stock_Label = c(MiSa1289 = "MIT9313",  MiSa1294 = "SS120", MiSa1315 = "MED4")

OlisSpectraMetaData %>%
   filter(ID == "MiSa1289" |
          ID == "MiSa1315" |
          ID == "MiSa1294" |
          ID == "MiSa1722" |
          ID == "MiSa1723") %>%
  ggplot() +
  geom_point(aes(x = nm, y = NormAbs_Blue_nm, colour = (ID))) +
 # geom_point(aes(x = nm, y = Absorbance, colour = ID)) +
 #scale_color_manual(values = Colours_nm) +
  #guides(colour = FALSE) +
 labs(y = "Normalized Absorbance", x = "Wavelength (nm)", size = 20, color = "black" ) +
    scale_y_continuous(breaks = c(0,0.2, 0.4,0.6, 0.8, 1.0, 1.2), limits = c (0, 1.2)) +
   # scale_y_continuous(breaks=seq(0, 0.2, by = 0.05)) +
 scale_color_manual(values = Stock_ID, label = Stock_Label) +
  # coord_cartesian(ylim = c (0, 0.2)) +
 #ggh4x::facet_nested(rows = vars(Par_ue),cols = vars(Strain, WL), labeller = labeller(Ex_WL = label_both, strain = label_value, WL = label_both, Photoperiod = label_both, Par_ue = label_both)) +
  theme_bw()+ 
 theme(
        axis.title = element_text(size = 20, color = "black"),
        axis.text = element_text(size = 15, color = "black"),
        # strip.background=element_rect(color="grey", fill = "grey"),
        # strip.background=element_rect(fill = "grey"),
        # legend.key.size = unit(1, 'cm'), #change legend key size
        # legend.key.height = unit(1, 'cm'), #change legend key height
        # legend.key.width = unit(0.5, 'cm'), #change legend key width
        legend.title = element_text(size = 15),  #change legend title font size
   legend.text = element_text(size = 15)) + #change legend text font size
  labs(colour = "Strain")


```

```{r remove unnecessary DF}
remove(OlisSpectraMetaData)
```

