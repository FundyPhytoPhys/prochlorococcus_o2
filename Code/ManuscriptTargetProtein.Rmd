---
title: "ManuscriptTargetProtein"
author: "Mireille Savoie"
date: "`r format(Sys.Date())`"
output:
  bookdown::html_document2:
    code_folding: show
    keep_md: yes
    toc: TRUE
    toc_float: TRUE
    toc_depth: 6
    fig_caption: yes
    pandoc_args: 
      - '--lua-filter=scholarly-metadata.lua'
      - '--lua-filter=author-info-blocks.lua'
  bookdown::word_document2:
    code_folding: show
    keep_md: yes
    toc: TRUE
    toc_depth: 6
    fig_caption: yes
    pandoc_args: 
      - '--lua-filter=scholarly-metadata.lua'
      - '--lua-filter=author-info-blocks.lua'
bibliography: [Manuscript_O2.bib, RPackages.bib]
csl: plos-one.csl
editor_options: 
  markdown: 
    wrap: 72
---

# Introduction

*Some of the code used to create this R Notebook was refurbished from "PlateAbImport.Rmd" written by Maximilian Berthold, Douglas A. Campbell, Melissa L. Rioux, Sarah J Gore, and Alyson MacCormack.*

Importing and tidying data from a .csv containing already processed target proteins

```{r set project variables}

Project <- "PICO"
DataIn <- file.path("..","Data", "ProcessedData")
DataOut <- file.path("..", "Data", "CleanData")
PlotsOut <- file.path("..","Output", "Figures")

FileEncode <- "UTF-8" 
Delimiter <- ","

HeaderRows <- 0
#AbsWL = c(680, 720, 750) #select OD's of interest from plategrowth.Rds
```

```{r}
library(tidyverse)
library(lubridate)
library(stringr)
library(broom)
library(knitr)
# library(OneR)
# library(zoo)
# library(strucchange)
library(photobiology)
library(dplyr)
# library(magrittr)
library(googledrive)
library(googlesheets4)
library(readxl)
```


```{r read locally stored metadata from rds}

CultureCatalog <- readRDS(file = file.path("..", "Data","CultureCatalog.Rds"))

```


```{r read ProcessFile}

TargetProtein <- read.csv(file = file.path(DataIn,"2020_PICO_Multi_TargetProteins.csv"))

glimpse(TargetProtein)

TargetProtein <- TargetProtein %>%
  rename(SampleID = "ï..Sample")

glimpse(TargetProtein)
 
```


```{r set colours}

# MyWavelengths = c(450, 530, 660, "WW")
# MCMIXColours = c(w_length2rgb(450), w_length2rgb(530), w_length2rgb(660), "black")

MyWavelengths = c("WW", 660, 530, 450)
MCMIXColours = c("black",  w_length2rgb(660), w_length2rgb(530),  w_length2rgb(450))

names(MCMIXColours) <- MyWavelengths
MCMIXColours




ColoursStrain = c(MIT9313 = "#E69F00", SS120 = "#F0E442", MED4 = "#CC79A7" )

MyOxygen = c(2.5, 25, 250 )
# ColourOxygen = c("#99CCFF", "dodgerblue", "blue1")
ColourOxygen = c("#FFCC00", "#FF9900", "#663300")
names(ColourOxygen) <- MyOxygen
ColourOxygen

MyOxygen = c(2.5, 25, 250 )
LineTypeOxygen = c("dotted", "longdash", "solid")
names(LineTypeOxygen) <- MyOxygen
LineTypeOxygen

MyPhotoperiods = as.factor(c(4, 8, 12, 16))
ColoursPhotoperiod = c("gray88", "lightcyan3", "gray47", "gray8")
names(ColoursPhotoperiod) <- MyPhotoperiods
ColoursPhotoperiod

```


```{r join protein data with culture meta data}

TargetProtein  <- TargetProtein %>% 
 left_join(., CultureCatalog, by = c("SampleID" = "SampleID"))

glimpse(TargetProtein)

```

```{r order protein by biological process}

TargetProtein  <- TargetProtein %>% 
 mutate(Target = factor(Target, levels = c("FtsH", "PsbA", "PetC", "PsaC", "RbcL")),
        O2_uM = case_when(O2 == 0 ~ 2.5,
                          O2 == 2 ~ 25,
                          O2 == 21 ~ 250),
        O2_uM = factor(O2_uM, levels = c(250, 25, 2.5)),
         WL= factor(WL, levels = c("WW", 660, 530, 450)))

glimpse(TargetProtein)

```

```{r Protein plots}

MIT9313ProteinAnnotated <- TargetProtein %>%
  filter(Strain == "MIT9313") %>% 
   mutate(OxygenLabel = "Oxygen Concentration (µM)",
         ParLabel = case_when(Par_ue %in% c(30, 90, 100, 180) ~ paste(Par_ue, "µE", sep = " ")),
        O2_uM = factor(O2_uM, levels = c("250", "2.5")),
        ParLabel = factor(ParLabel, levels = c("30 µE", "90 µE", "100 µE", "180 µE"))) %>% 
   ggplot(aes(x=Target, y= Target_TotalProtein_fmole_ug, color = as.factor(WL), fill = as.factor(WL))) +
  geom_col(position="Dodge") +
   # geom_text(aes(y = 0.05, label = paste(round(Target_TotalProtein_fmole_ug, 0)),  hjust = 0.5, vjust = -1.5, position = "stack", check_overlap = T), color = "Black")  +
 labs(y = "Protein subunit content" ~   "(fmole µg"  ~ protein^-1~")", x = "Protein") +
  scale_fill_manual(values = MCMIXColours) +
  scale_colour_manual(values = MCMIXColours) +
 ggh4x::facet_nested(cols = vars(Strain, ParLabel ), rows = vars(OxygenLabel, O2_uM), 
                    labeller = labeller(O2_uM = label_value, WL = label_both, O2 = label_both, Strain = label_value)) +
guides(color = "none") +
  theme_bw() +
  theme(legend.position = "top") +
  labs(fill = "Growth Waveband (nm)")

MIT9313ProteinAnnotated


MED4ProteinAnnotated <- TargetProtein %>%
  filter( Strain == "MED4",
          O2_uM != 2.5) %>% 
   mutate(OxygenLabel = "Oxygen Concentration (µM)",
         ParLabel = case_when(Par_ue %in% c(30, 90, 100, 180) ~ paste(Par_ue, "µE", sep = " ")),
        O2_uM = factor(O2_uM, levels = c("250", "2.5")),
        ParLabel = factor(ParLabel, levels = c("30 µE", "90 µE", "100 µE", "180 µE"))) %>% 
  ggplot(aes(x=Target, y= Target_TotalProtein_fmole_ug, color = as.factor(WL), fill = as.factor(WL))) +
  geom_col(position="Dodge") +
   # geom_text(aes(y = 0.05, label = paste(round(Target_TotalProtein_fmole_ug, 0)), na.rm=FALSE ,  hjust = 0.5, vjust = -1.5, position = "stack", check_overlap = T), color = "Black") +
 labs(y = "Protein subunit content" ~   "(fmole µg"  ~ protein^-1~")", x = "Protein") +
  scale_fill_manual(values = MCMIXColours) +
  scale_colour_manual(values = MCMIXColours) +
  ggh4x::facet_nested(cols = vars(Strain, ParLabel ), rows = vars(OxygenLabel, O2_uM), 
                    labeller = labeller(O2_uM = label_value, WL = label_both, O2 = label_both, Strain = label_value)) +
guides(color = "none") +
  theme_bw() +
  theme(legend.position = "top") +
  labs(fill = "Growth Waveband (nm)")

MED4ProteinAnnotated
```

```{r }

 ggsave(file = file.path(PlotsOut, paste("MED4ProteinAnnotated",".png",sep = "")), plot = MED4ProteinAnnotated, device = NULL, scale = 1, height=15, width= 25, units = c("cm"),dpi = 300, limitsize = TRUE)

ggsave(file = file.path(PlotsOut, paste("MIT9313ProteinAnnotated",".png",sep = "")), plot = MIT9313ProteinAnnotated, device = NULL, scale = 1, height=15, width= 25, units = c("cm"),dpi = 300, limitsize = TRUE)

```



```{r, save rds}

saveRDS(TargetProtein, file.path(DataOut, paste(Project, "TargetProtein.Rds", sep = "_"), fsep = .Platform$file.sep))


# saveRDS(ChlTurnerCytometerAll, file.path(DataOut, paste(Project, "ChlTurnerMiSa.Rds", sep = "_"), fsep = .Platform$file.sep))
```

